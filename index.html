<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ikapop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="iOS">
<meta property="og:type" content="website">
<meta property="og:title" content="ikapop">
<meta property="og:url" content="http://ikapop.com/index.html">
<meta property="og:site_name" content="ikapop">
<meta property="og:description" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ikapop">
<meta name="twitter:description" content="iOS">
  
  
    <link rel="icon" href="favicon.png">
  
  
 <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>


  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/css/images/logo.png)"></i><span class="site-title">ikapop</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="http://7xp2md.com1.z0.glb.clouddn.com/resizeApi.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://ikapop.com"></form>
        
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/categories">Categories</a></td>
        
          <td><a class="main-nav-link" href="/tags">Tags</a></td>
        
          <td><a class="main-nav-link" href="/about">About</a></td>
        
        <td>
          
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="搜索"><input type="hidden" name="sitesearch" value="http://ikapop.com"></form>
          
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <img id="avatar" src="http://7xp2md.com1.z0.glb.clouddn.com/resizeApi.png">
      <h2 id="name">ikapop</h2>
      <h3 id="title">iOS Developer &amp; Java Web</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Beijing, China</span>
      <a id="follow" href="https://github.com/kapop">关注我</a>
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        10
        <span>文章</span>
      </div>
      <div class="article-info-block">
        3
        <span>标签</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="http://github.com/kapop" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="https://twitter.com/funkapop" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="/#" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
          
          <td><a href="/#" target="_blank" title="dribbble"><i class="fa fa-dribbble"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
        </tr>
      </table>
    </div>
    
    
  </div>
</aside>

      
      <section id="main">
      <article id="post-JSON转Model方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/07/JSON转Model方法/">Json转换Model方法</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2016/01/07/JSON转Model方法/">
      <time datetime="2016-01-06T16:00:00.000Z" itemprop="datePublished">2016-01-07</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h3 id="u5E38_u7528_u7B2C_u4E09_u65B9_u5E93Json_u8F6CModel"><a href="#u5E38_u7528_u7B2C_u4E09_u65B9_u5E93Json_u8F6CModel" class="headerlink" title="常用第三方库Json转Model"></a>常用第三方库Json转Model</h3><p>我目前用的比较多的库MJExtension,YYModel,JSONModel</p>
<p><a href="https://github.com/CoderMJLee/MJExtension" target="_blank" rel="external">MJExtension</a></p>
<p><strong>安装方式</strong></p>
<p>cocoapods：在Podfile中添加pod ‘MJExtension’,添加建议使用pod update –no-repo-update,不然速度奇慢</p>
<p>手工：下载文件导入主头文件 #import “MJExtension”</p>
<p><strong>使用</strong></p>
<p>导入主头文件 #import “MJExtension”</p>
<p>JSON -&gt; Model【最简单的字典转模型】</p>
<p>NSDictionary *dict = @{@”propertyname”:@”value”};</p>
<p>Model *model = [Model mj_objectWithKeyValues:dict];</p>
<p><a href="https://github.com/ibireme/YYModel" target="_blank" rel="external">YYModel</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2016/01/07/JSON转Model方法/" data-id="cij3xyfzv0000cdq0r0h02gux" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2016/01/07/JSON转Model方法/#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-我的2015" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/01/我的2015/">我的2015</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2016/01/01/我的2015/">
      <time datetime="2015-12-31T16:00:00.000Z" itemprop="datePublished">2016-01-01</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>回头想想过去的一年还是发生了很多事情的，一方面是工作发生了一些变动，另一方面就是生活发生一些事情。</p>
<h2 id="u5DE5_u4F5C"><a href="#u5DE5_u4F5C" class="headerlink" title="工作"></a>工作</h2><p>  年初的时候进行了毕业后的第一次工作述职，述职的主要内容还是针对自己毕业后正式入职公司的半年的产出，现在看看当时准备的真是不怎么样，PPT没写几页，基本全是文字，别人的PPT准备的还可以，原本对自己的述职的PPT感觉还可以吧，把要说的东西的都说了，但是和别人的一比较，差距立即体现来了，用心准备的东西和没用心准备的很明显就能看出来。述职之后工作有了一些变化，就是转岗了，由原来的岗位转到Java开发岗，部门新开了一个项目，把我调到项目组，这个项目队我提升还是很大的，虽然工期是一拖再拖，最后在我离职的时候还没有做完，我是一开始都参与的项目，从项目的立项、报备、审批、准备、跨部门协调等，影响项目进度的原因是多方面的，但是任何一方面的原因都会阻挡项目的进度。工作内容和之前的还是有很大的不同，之前的工作主要是对外的，以调研、挖掘需求、分析需求为主，到以开发为主，内容还是发生很大变化，刚开始还是有一些不适应，因为经常需要跨部门交流，需要提前协调好各方面的资源，根本不能坐那安心的写代码。由于项目前期有一些分歧，项目一直是在争论阶段，一直没有往下推进，中间耽误了好久。后期开始的时候就是进入4月了。本来是第二个季度就应该完成的整个项目的，中间一直拖延，需求各种变化，一个项目两个领导，两个人意见经常还不一样，项目做的太蛋疼了。第三个季度都结束了，项目仍然是没有做完，中间又有同事离职。虽然做项目的体验是非常糟糕的，但总归是学到了一些知识，非常感谢我的小庄老师，在开发过程中交给我很多的知识。</p>
<p>虽然我还是离开我所喜欢的公司，工作是其中一小部分的原因，家里整天吵吵搞得也很心烦，再加上整个人的状态都不太好，所以还是出来换个环境。</p>
<h3 id="u6536_u83B7"><a href="#u6536_u83B7" class="headerlink" title="收获"></a>收获</h3><blockquote>
<p>项目进度管控<br>跨部门协调<br>工作汇报<br>独立解决问题的能力</p>
</blockquote>
<h2 id="u751F_u6D3B"><a href="#u751F_u6D3B" class="headerlink" title="生活"></a>生活</h2><blockquote>
<p>参加公司年会，表演了节目，很意外的获得了特等奖，是个不小的惊喜。<br>报了驾校<br>又成了单身狗<br>入手了kindle</p>
</blockquote>
<h2 id="2015_u7684_u4E66_u5355"><a href="#2015_u7684_u4E66_u5355" class="headerlink" title="2015的书单"></a>2015的书单</h2><blockquote>
<ul>
<li>我在淘宝的10年</li>
<li>数学之美</li>
<li>浪潮之巅</li>
<li>心理罪</li>
<li>三体全集(这个没有看完)</li>
<li>我的互联网方法论</li>
</ul>
</blockquote>
<h2 id="2016_u613F_u671B"><a href="#2016_u613F_u671B" class="headerlink" title="2016愿望"></a>2016愿望</h2><blockquote>
<ul>
<li><p>家人身体健康</p>
</li>
<li><p>开发技术能有一个大的提升</p>
</li>
<li><p>希望大家工作之余能锻炼下身体</p>
</li>
<li><p>读完10本书</p>
</li>
<li><p>祝大家新年快乐，工作顺利。</p>
</li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2016/01/01/我的2015/" data-id="ciiz8n9i40005cmq0yg939m66" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2016/01/01/我的2015/#disqus_thread" class="article-comment-link">评论</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/总结/">总结</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-Core Animation 核心动画" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/26/Core Animation 核心动画/">Core Animation 核心动画</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/26/Core Animation 核心动画/">
      <time datetime="2015-12-25T16:00:00.000Z" itemprop="datePublished">2015-12-26</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h2 id="Core_Animation__u6838_u5FC3_u52A8_u753B"><a href="#Core_Animation__u6838_u5FC3_u52A8_u753B" class="headerlink" title="Core Animation 核心动画"></a>Core Animation 核心动画</h2><h3 id="1-__u4EC0_u4E48_u662FCore_Animation_u6838_u5FC3_u52A8_u753B_2C__u6709_u4EC0_u4E48_u4F5C_u7528_3F"><a href="#1-__u4EC0_u4E48_u662FCore_Animation_u6838_u5FC3_u52A8_u753B_2C__u6709_u4EC0_u4E48_u4F5C_u7528_3F" class="headerlink" title="1. 什么是Core Animation核心动画, 有什么作用?"></a>1. 什么是Core Animation核心动画, 有什么作用?</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="number">1</span>&gt;<span class="class">.CABasicAnimation</span></span><br><span class="line">通过设定起始点，终点，时间，动画会沿着你这设定点进行移动。可以看做特殊的CAKeyFrameAnimation</span><br><span class="line">&lt;<span class="number">2</span>&gt;<span class="class">.CAKeyframeAnimation</span></span><br><span class="line">Keyframe顾名思义就是关键点的frame，你可以通过设定CALayer的始点、中间关键点、终点的frame，时间，动画会沿你设定的轨迹进行移动</span><br><span class="line">&lt;<span class="number">3</span>&gt;<span class="class">.CAAnimationGroup</span></span><br><span class="line">Group也就是组合的意思，就是把对这个Layer的所有动画都组合起来。PS：一个layer设定了很多动画，他们都会同时执行，如何按顺序执行我到时候再讲。</span><br><span class="line">&lt;<span class="number">4</span><span class="class">.CATransition</span></span><br><span class="line">这个就是苹果帮开发者封装好的一些动画，</span><br></pre></td></tr></table></figure>
<h3 id="2-__u57FA_u7840_u52A8_u753B"><a href="#2-__u57FA_u7840_u52A8_u753B" class="headerlink" title="2. 基础动画"></a>2. 基础动画</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)basicAnimation &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个CABasicAnimation对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation=[<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    animation<span class="variable">.toValue</span>=(<span class="keyword">id</span>)[<span class="built_in">UIColor</span> blueColor]<span class="variable">.CGColor</span>;</span><br><span class="line">    <span class="comment">//动画时间</span></span><br><span class="line">    animation<span class="variable">.duration</span>=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//是否反转变为原来的属性值</span></span><br><span class="line">    animation<span class="variable">.autoreverses</span>=<span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">//把animation添加到图层的layer中，便可以播放动画了。forKey指定要应用此动画的属性</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.view</span><span class="variable">.layer</span> addAnimation:animation forKey:<span class="string">@"backgroundColor"</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-__u5173_u952E_u5E27_u52A8_u753B"><a href="#3-__u5173_u952E_u5E27_u52A8_u753B" class="headerlink" title="3. 关键帧动画"></a>3. 关键帧动画</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)animationOf<span class="built_in">CAKeyframeAnimationPath</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//初始化一个View，用来显示动画</span></span><br><span class="line">    <span class="built_in">UIView</span> *redView=[[<span class="built_in">UIView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">20</span>)];</span><br><span class="line">    redView<span class="variable">.backgroundColor</span>=[<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addSubview:redView];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *ani=[<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> aPath=<span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPathMoveToPoint</span>(aPath, <span class="literal">nil</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">CGPathAddCurveToPoint</span>(aPath, <span class="literal">nil</span>,</span><br><span class="line">                          <span class="number">160</span>, <span class="number">30</span>,</span><br><span class="line">                          <span class="number">220</span>, <span class="number">220</span>,</span><br><span class="line">                          <span class="number">240</span>, <span class="number">380</span>);</span><br><span class="line">    </span><br><span class="line">    ani<span class="variable">.path</span>=aPath;</span><br><span class="line">    ani<span class="variable">.duration</span>=<span class="number">5</span>;</span><br><span class="line">    ani<span class="variable">.timingFunction</span>=[<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseIn</span>];</span><br><span class="line">    ani<span class="variable">.rotationMode</span>=<span class="string">@"auto"</span>;</span><br><span class="line">    [redView<span class="variable">.layer</span> addAnimation:ani forKey:<span class="string">@"position"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-__u52A8_u753B_u7EC4"><a href="#4-__u52A8_u753B_u7EC4" class="headerlink" title="4. 动画组"></a>4. 动画组</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)animationOfGroup</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//添加图片</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"group"</span>);</span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"freya.png"</span>]];</span><br><span class="line">    imgView<span class="variable">.frame</span> = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">30</span>, <span class="number">100</span>, <span class="number">60</span>);</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addSubview:imgView];</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//贝塞尔曲线路径</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *movePath = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">    [movePath moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">10.0</span>, <span class="number">10.0</span>)];</span><br><span class="line">    [movePath addQuadCurveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">300</span>) controlPoint:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">100</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//以下必须导入QuartzCore包</span></span><br><span class="line">    <span class="comment">//关键帧动画（位置）</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> * posAnim = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    posAnim<span class="variable">.path</span> = movePath<span class="variable">.CGPath</span>;</span><br><span class="line">    posAnim<span class="variable">.removedOnCompletion</span> = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//缩放动画</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *scaleAnim = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</span><br><span class="line">    scaleAnim<span class="variable">.fromValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DIdentity</span>];</span><br><span class="line">    scaleAnim<span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DMakeScale</span>(<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">1.0</span>)];</span><br><span class="line">    scaleAnim<span class="variable">.removedOnCompletion</span> = <span class="literal">YES</span>;</span><br><span class="line">    scaleAnim<span class="variable">.beginTime</span> = <span class="number">0.2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//透明动画</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *opacityAnim = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"alpha"</span>];</span><br><span class="line">    opacityAnim<span class="variable">.fromValue</span> = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">1.0</span>];</span><br><span class="line">    opacityAnim<span class="variable">.toValue</span> = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">0.1</span>];</span><br><span class="line">    opacityAnim<span class="variable">.removedOnCompletion</span> = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//动画组</span></span><br><span class="line">    <span class="built_in">CAAnimationGroup</span> *animGroup = [<span class="built_in">CAAnimationGroup</span> animation];</span><br><span class="line">    animGroup<span class="variable">.animations</span> = [<span class="built_in">NSArray</span> arrayWithObjects:posAnim, scaleAnim, opacityAnim, <span class="literal">nil</span>];</span><br><span class="line">    animGroup<span class="variable">.duration</span> = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    [imgView<span class="variable">.layer</span> addAnimation:animGroup forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-__u8F6C_u573A_u52A8_u753B"><a href="#5-__u8F6C_u573A_u52A8_u753B" class="headerlink" title="5. 转场动画"></a>5. 转场动画</h3><h4 id="u521B_u5EFA_u8F6C_u573A_u52A8_u753B"><a href="#u521B_u5EFA_u8F6C_u573A_u52A8_u753B" class="headerlink" title="创建转场动画"></a>创建转场动画</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> 动画类型</span><br><span class="line"> fade 淡出效果</span><br><span class="line"> moveIn 新视图移动到旧视图</span><br><span class="line"> push   新视图推出旧视图</span><br><span class="line"> reveal 移开旧视图</span><br><span class="line"> cube   立方体翻转效果</span><br><span class="line"> oglFlip    翻转效果</span><br><span class="line"> suckEffect 收缩效果</span><br><span class="line"> rippleEffect   水滴波纹效果</span><br><span class="line"> pageCurl   向下翻页</span><br><span class="line"> pageUnCurl 向上翻页</span><br><span class="line"> */</span></span><br><span class="line">-(<span class="built_in">CATransition</span> *)createTransitionAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//切换之前添加动画效果</span></span><br><span class="line">    <span class="comment">//后面知识: Core Animation 核心动画</span></span><br><span class="line">    <span class="comment">//不要写成: CATransaction</span></span><br><span class="line">    <span class="comment">//创建CATransition动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    <span class="comment">//设置动画的类型:</span></span><br><span class="line">    animation<span class="variable">.type</span> = <span class="string">@"cube"</span>;</span><br><span class="line">    <span class="comment">//设置动画的方向</span></span><br><span class="line">    animation<span class="variable">.subtype</span> = k<span class="built_in">CATransitionFromLeft</span>;</span><br><span class="line">    <span class="comment">//设置动画的持续时间</span></span><br><span class="line">    animation<span class="variable">.duration</span> = <span class="number">1.5</span>;</span><br><span class="line">    <span class="comment">//设置动画速率(可变的)</span></span><br><span class="line">    animation<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    <span class="comment">//动画添加到切换的过程中</span></span><br><span class="line">    <span class="keyword">return</span> animation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u5207_u6362_u754C_u9762_u6DFB_u52A0_u52A8_u753B"><a href="#u5207_u6362_u754C_u9762_u6DFB_u52A0_u52A8_u753B" class="headerlink" title="切换界面添加动画"></a>切换界面添加动画</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MainViewController *mvc = [[MainViewController alloc] init];</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//添加动画</span></span><br><span class="line">   [<span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.view</span><span class="variable">.layer</span> addAnimation:[<span class="keyword">self</span> createTransitionAnimation] forKey:<span class="literal">nil</span>];</span><br><span class="line">   </span><br><span class="line">   [<span class="keyword">self</span><span class="variable">.navigationController</span> pushViewController:mvc animated:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/26/Core Animation 核心动画/" data-id="ciiz8n9im000hcmq0h2xy8yhw" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/26/Core Animation 核心动画/#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-通讯录使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/20/通讯录使用/">通讯录</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/20/通讯录使用/">
      <time datetime="2015-12-19T16:00:00.000Z" itemprop="datePublished">2015-12-20</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h2 id="u901A_u8BAF_u5F55_u4F7F_u7528_28iOS9_29"><a href="#u901A_u8BAF_u5F55_u4F7F_u7528_28iOS9_29" class="headerlink" title="通讯录使用(iOS9)"></a>通讯录使用(iOS9)</h2><h3 id="1-_u901A_u8BAF_u5F55_u4F7F_u7528_u7B80_u4ECB"><a href="#1-_u901A_u8BAF_u5F55_u4F7F_u7528_u7B80_u4ECB" class="headerlink" title="1.通讯录使用简介"></a>1.通讯录使用简介</h3><p>iOS8: AddressBook.framework,<br>        AddressBookUI.framework</p>
<p>iOS9:    Contact.framework, ContactUI.framework</p>
<h3 id="2-_u901A_u8BAF_u5F55_u4F7F_u7528"><a href="#2-_u901A_u8BAF_u5F55_u4F7F_u7528" class="headerlink" title="2.通讯录使用"></a>2.通讯录使用</h3><h4 id="281_29-_u914D_u7F6E"><a href="#281_29-_u914D_u7F6E" class="headerlink" title="(1).配置"></a>(1).配置</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先添加库文件</span></span><br><span class="line"><span class="comment">//Contact.framework, </span></span><br><span class="line"><span class="comment">//ContactUI.framework</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加头文件</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Contacts/Contacts.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;ContactsUI/ContactsUI.h&gt;</span></span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#### (2).插入联系人</span></span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line"> <span class="comment">//创建联系人</span></span><br><span class="line">    CNMutableContact * contact = [[CNMutableContact alloc]init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置头像</span></span><br><span class="line">    contact<span class="variable">.imageData</span> = <span class="built_in">UIImagePNGRepresentation</span>([<span class="built_in">UIImage</span> imageNamed:<span class="string">@"me.png"</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置名字</span></span><br><span class="line">    contact<span class="variable">.givenName</span> = <span class="string">@"jaki"</span>;</span><br><span class="line">    <span class="comment">//设置姓氏</span></span><br><span class="line">    contact<span class="variable">.familyName</span> = <span class="string">@"zhang"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//联系人邮箱</span></span><br><span class="line">    CNLabeledValue *homeEmail = [CNLabeledValue labeledValueWithLabel:CNLabelHome value:<span class="string">@"316045346@qq.com"</span>];</span><br><span class="line">    CNLabeledValue *workEmail =[CNLabeledValue labeledValueWithLabel:CNLabelWork value:<span class="string">@"316045346@qq.com"</span>];</span><br><span class="line">    contact<span class="variable">.emailAddresses</span> = @[homeEmail,workEmail];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置联系人电话</span></span><br><span class="line">    contact<span class="variable">.phoneNumbers</span> = @[[CNLabeledValue labeledValueWithLabel:CNLabelPhoneNumberiPhone value:[CNPhoneNumber phoneNumberWithStringValue:<span class="string">@"12344312321"</span>]]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//生日</span></span><br><span class="line">    <span class="built_in">NSDateComponents</span> * birthday = [[<span class="built_in">NSDateComponents</span>  alloc]init];</span><br><span class="line">    birthday<span class="variable">.day</span>=<span class="number">7</span>;</span><br><span class="line">    birthday<span class="variable">.month</span>=<span class="number">5</span>;</span><br><span class="line">    birthday<span class="variable">.year</span>=<span class="number">1992</span>;</span><br><span class="line">    contact<span class="variable">.birthday</span>=birthday;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//初始化方法</span></span><br><span class="line">    C<span class="built_in">NSaveRequest</span> * saveRequest = [[C<span class="built_in">NSaveRequest</span> alloc]init];</span><br><span class="line">    <span class="comment">//添加联系人</span></span><br><span class="line">    [saveRequest addContact:contact toContainerWithIdentifier:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    CNContactStore * store = [[CNContactStore alloc]init];</span><br><span class="line">    [store executeSaveRequest:saveRequest error:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<h4 id="283_29-_u83B7_u53D6_u6307_u5B9A_u8054_u7CFB_u4EBA"><a href="#283_29-_u83B7_u53D6_u6307_u5B9A_u8054_u7CFB_u4EBA" class="headerlink" title="(3).获取指定联系人"></a>(3).获取指定联系人</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CNContactStore * stroe = [[CNContactStore alloc]init];</span><br><span class="line"><span class="comment">//检索条件，检索所有名字中有zhang的联系人</span></span><br><span class="line"><span class="built_in">NSPredicate</span> * predicate = [CNContact predicateForContactsMatchingName:<span class="string">@"zhang"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//提取数据</span></span><br><span class="line"><span class="comment">//keysToFetch参数: 包含需要提取的数据</span></span><br><span class="line"><span class="built_in">NSArray</span> * contacts = [stroe unifiedContactsMatchingPredicate:predicate keysToFetch:@[CNContactGivenNameKey,CNContactFamilyNameKey,CNContactPhoneNumbersKey] error:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(CNContact *c <span class="keyword">in</span> contacts)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ - %@ : %@"</span>,c<span class="variable">.givenName</span>,c<span class="variable">.familyName</span>,c<span class="variable">.phoneNumbers</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="284_29-_u904D_u5386_u6240_u6709_u8054_u7CFB_u4EBA"><a href="#284_29-_u904D_u5386_u6240_u6709_u8054_u7CFB_u4EBA" class="headerlink" title="(4).遍历所有联系人"></a>(4).遍历所有联系人</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CNContactStore * stroe = [[CNContactStore alloc]init];</span><br><span class="line">    CNContactFetchRequest * request = [[CNContactFetchRequest alloc]initWithKeysToFetch:@[CNContactGivenNameKey,CNContactFamilyNameKey,CNContactPhoneNumbersKey]];</span><br><span class="line">    [stroe enumerateContactsWithFetchRequest:request error:<span class="literal">nil</span> usingBlock:^(CNContact * _Nonnull contact, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//NSLog(@"-&gt;%@ %@ %@",contact.givenName,contact.familyName,contact.phoneNumbers);</span></span><br><span class="line">        CNLabeledValue *phone = [contact<span class="variable">.phoneNumbers</span> firstObject];</span><br><span class="line">        CNPhoneNumber *number = phone<span class="variable">.value</span>;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"-&gt;%@ %@ %@"</span>,contact<span class="variable">.givenName</span>,contact<span class="variable">.familyName</span>,number<span class="variable">.stringValue</span>);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<h4 id="285_29-_u9009_u62E9_u6307_u5B9A_u8054_u7CFB_u4EBA"><a href="#285_29-_u9009_u62E9_u6307_u5B9A_u8054_u7CFB_u4EBA" class="headerlink" title="(5).选择指定联系人"></a>(5).选择指定联系人</h4><p>首先打开选取视图控制器</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CNContactPickerViewController * con = [[CNContactPickerViewController alloc]init];</span><br><span class="line">    con<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:con animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>实现指定视图方法获取选中的联系人, 注意遵守协议</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//视图取消时 调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)contactPickerDidCancel:(CNContactPickerViewController *)picker</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//选中与取消选中时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)contactPicker:(CNContactPickerViewController *)picker didSelectContact:(CNContact *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"sel %@-%@ "</span>,contact<span class="variable">.givenName</span>,contact<span class="variable">.familyName</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/20/通讯录使用/" data-id="ciiz8n9hw0003cmq0r9wk5n67" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/20/通讯录使用/#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-核心数据? 有什么用途" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/18/核心数据? 有什么用途/">CoreData</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/18/核心数据? 有什么用途/">
      <time datetime="2015-12-17T16:00:00.000Z" itemprop="datePublished">2015-12-18</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>#CoreData核心数据 (iOS9)</p>
<h3 id="1-_u4EC0_u4E48_u662F_u6838_u5FC3_u6570_u636E_3F__u6709_u4EC0_u4E48_u7528_u9014"><a href="#1-_u4EC0_u4E48_u662F_u6838_u5FC3_u6570_u636E_3F__u6709_u4EC0_u4E48_u7528_u9014" class="headerlink" title="1.什么是核心数据? 有什么用途"></a>1.什么是核心数据? 有什么用途</h3><p>1.Core Data 是数据持久化存储的最佳方式</p>
<p>2.数据最终的存储类型可以是：SQLite数据库，XML，二进制，内存里，或自定义数据类型</p>
<p>在Mac OS X 10.5Leopard及以后的版本中，开发者也可以通过继承NSPersistentStore类以创建自定义的存储格式</p>
<p>3.好处：能够合理管理内存，避免使用sql的麻烦，高效</p>
<h3 id="2-_u4F7F_u7528_u524D_u7684_u914D_u7F6E"><a href="#2-_u4F7F_u7528_u524D_u7684_u914D_u7F6E" class="headerlink" title="2.使用前的配置"></a>2.使用前的配置</h3><h4 id="281_29-__u521B_u5EFA_u5DE5_u7A0B"><a href="#281_29-__u521B_u5EFA_u5DE5_u7A0B" class="headerlink" title="(1). 创建工程"></a>(1). 创建工程</h4><p>注意: 创建工程的时候选择 Use Core Data</p>
<h4 id="282_29__u4EE3_u7801_u89E3_u91CA"><a href="#282_29__u4EE3_u7801_u89E3_u91CA" class="headerlink" title="(2) 代码解释"></a>(2) 代码解释</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)NSManagedObjectContext（被管理的数据上下文）</span><br><span class="line"></span><br><span class="line">操作实际内容（操作持久层）</span><br><span class="line"></span><br><span class="line">作用：插入数据，查询数据，删除数据</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)NSManagedObjectModel（被管理的数据模型）</span><br><span class="line"></span><br><span class="line">数据库所有表格或数据结构，包含各实体的定义信息</span><br><span class="line"></span><br><span class="line">作用：添加实体的属性，建立属性之间的关系</span><br><span class="line"></span><br><span class="line">操作方法：视图编辑器，或代码</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)NSPersistentStoreCoordinator（持久化存储助理）</span><br><span class="line"></span><br><span class="line">相当于数据库的连接器</span><br><span class="line"></span><br><span class="line">作用：设置数据存储的名字，位置，存储方式，和存储时机</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)NSManagedObject（被管理的数据记录）</span><br><span class="line"></span><br><span class="line">相当于数据库中的表格记录</span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)NSFetchRequest（获取数据的请求）</span><br><span class="line"></span><br><span class="line">相当于查询语句</span><br><span class="line"></span><br><span class="line">(<span class="number">6</span>)NSEntityDescription（实体结构）</span><br><span class="line"></span><br><span class="line">相当于表格结构</span><br><span class="line"></span><br><span class="line">(<span class="number">7</span>)后缀为.xcdatamodeld的包</span><br><span class="line"></span><br><span class="line">里面是.xcdatamodel文件，用数据模型编辑器编辑</span><br><span class="line"></span><br><span class="line">编译后为.momd或.mom文件</span><br></pre></td></tr></table></figure>
<h4 id="283_29-_u4F7F_u7528_u524D_u7684_u914D_u7F6E"><a href="#283_29-_u4F7F_u7528_u524D_u7684_u914D_u7F6E" class="headerlink" title="(3).使用前的配置"></a>(3).使用前的配置</h4><ul>
<li><p>选择CoreDataDemo.xcdatamodeld, 添加一个Entity, 命名为User</p>
</li>
<li><p>添加三个属性name,age,sex, 类型分别是String,Integer 32, String</p>
</li>
<li><p>添加依赖关系<br>relationship – User – relationship</p>
</li>
<li><p>Eidetor 添加对应的类</p>
</li>
</ul>
<h3 id="3-_u6570_u636E_u7684_u589E_u5220_u6539_u67E5"><a href="#3-_u6570_u636E_u7684_u589E_u5220_u6539_u67E5" class="headerlink" title="3.数据的增删改查"></a>3.数据的增删改查</h3><p>//添加头文件, 获取代理</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="id">#import</span> <span class="string">"User.h"</span></span><br><span class="line"><span class="id">#import</span> <span class="string">"User+CoreDataProperties.h"</span></span><br><span class="line"><span class="id">#import</span> <span class="string">"AppDelegate.h"</span></span><br></pre></td></tr></table></figure>
<p>获取AppDelegate对象<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先定义</span></span><br><span class="line">AppDelegate *myAppDelegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后在viewDidLoad中初始化</span></span><br><span class="line">myAppDelegate = [UIApplication sharedApplication].<span class="keyword">delegate</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>添加数据</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)testInsert</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    User*user = (User*)[<span class="built_in">NSEntityDescription</span> insertNewObjectForEntityForName:<span class="string">@"User"</span> inManagedObjectContext:myAppDelegate<span class="variable">.managedObjectContext</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置数据</span></span><br><span class="line">    [user setName:<span class="string">@"lisi"</span>];</span><br><span class="line">    [user setAge:[<span class="built_in">NSNumber</span> numberWithInteger:<span class="number">20</span>]];</span><br><span class="line">    [user setSex:<span class="string">@"男"</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//发起请求</span></span><br><span class="line">    <span class="built_in">NSError</span>*error;</span><br><span class="line">    <span class="built_in">BOOL</span> isSaveSuccess = [myAppDelegate<span class="variable">.managedObjectContext</span> save:&amp;error];<span class="comment">//保存（容易忘）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!isSaveSuccess) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error:%@"</span>,error);</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Save Successful!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>查询数据</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)testSelect</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//数据请求（请求）：命令集</span></span><br><span class="line">    <span class="built_in">NSFetchRequest</span>*request = [[<span class="built_in">NSFetchRequest</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//NSEntityDescription（实体描述）：表</span></span><br><span class="line">    <span class="built_in">NSEntityDescription</span>*user = [<span class="built_in">NSEntityDescription</span> entityForName:<span class="string">@"User"</span> inManagedObjectContext:myAppDelegate<span class="variable">.managedObjectContext</span>];</span><br><span class="line">    [request setEntity:user];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//发起请求</span></span><br><span class="line">    <span class="built_in">NSError</span>*error;</span><br><span class="line">    <span class="built_in">NSArray</span>*mutablefetchResult = [myAppDelegate<span class="variable">.managedObjectContext</span> executeFetchRequest:request error:&amp;error];</span><br><span class="line">    <span class="keyword">if</span> (mutablefetchResult == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>,mutablefetchResult);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"the count of entry:%lu"</span>,[mutablefetchResult count]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//输出所有信息</span></span><br><span class="line">    <span class="keyword">for</span> (User*user <span class="keyword">in</span> mutablefetchResult) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"name:%@------age:%@-------sex:%@"</span>,user<span class="variable">.name</span>,user<span class="variable">.age</span>,user<span class="variable">.sex</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>修改数据</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)testUpdate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//NSFetchRequest 数据请求（请求）：命令集</span></span><br><span class="line">    <span class="built_in">NSFetchRequest</span>*request = [[<span class="built_in">NSFetchRequest</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//NSEntityDescription（实体描述）：表</span></span><br><span class="line">    <span class="built_in">NSEntityDescription</span>*user = [<span class="built_in">NSEntityDescription</span> entityForName:<span class="string">@"User"</span> inManagedObjectContext:myAppDelegate<span class="variable">.managedObjectContext</span>];</span><br><span class="line">    [request setEntity:user];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置查询条件 NSPredicate （谓词）：查询语句</span></span><br><span class="line">    <span class="built_in">NSPredicate</span>*predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == %@"</span>,<span class="string">@"lisi"</span>];</span><br><span class="line">    [request setPredicate:predicate];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//执行查询</span></span><br><span class="line">    <span class="built_in">NSError</span>*error;</span><br><span class="line">    <span class="built_in">NSArray</span> * mutablFetchResult = [myAppDelegate<span class="variable">.managedObjectContext</span> executeFetchRequest:request error:&amp;error];</span><br><span class="line">    <span class="keyword">if</span> (mutablFetchResult == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error:%@"</span>,error);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"the count of entry:%lu"</span>,[mutablFetchResult count]);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//修改数据</span></span><br><span class="line">    <span class="keyword">for</span> (User*user <span class="keyword">in</span> mutablFetchResult) &#123;</span><br><span class="line">        [user setAge:[<span class="built_in">NSNumber</span> numberWithInteger:<span class="number">999</span>]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否修改成功</span></span><br><span class="line">    <span class="built_in">BOOL</span> isSaveSuccess = [myAppDelegate<span class="variable">.managedObjectContext</span> save:&amp;error];<span class="comment">//保存（容易忘）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!isSaveSuccess)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error:%@"</span>,error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"update Successful!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>删除数据</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)testDelete</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//数据请求（命令集）</span></span><br><span class="line">    <span class="built_in">NSFetchRequest</span>*request = [[<span class="built_in">NSFetchRequest</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//实体描述（表）</span></span><br><span class="line">    <span class="built_in">NSEntityDescription</span>*user = [<span class="built_in">NSEntityDescription</span> entityForName:<span class="string">@"User"</span> inManagedObjectContext:myAppDelegate<span class="variable">.managedObjectContext</span>];</span><br><span class="line">    [request setEntity:user];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置查询条件</span></span><br><span class="line">    <span class="built_in">NSPredicate</span>* predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == %@"</span>,<span class="string">@"lisi"</span>];</span><br><span class="line">    [request setPredicate:predicate];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//发起请求</span></span><br><span class="line">    <span class="built_in">NSError</span>*error;</span><br><span class="line">    <span class="built_in">NSArray</span>*mutableFetchResult = [myAppDelegate<span class="variable">.managedObjectContext</span> executeFetchRequest:request error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (mutableFetchResult == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error:%@"</span>,error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"mutableFetchResult %lu"</span>,[mutableFetchResult count]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (User*user <span class="keyword">in</span> mutableFetchResult) &#123;</span><br><span class="line">        [myAppDelegate<span class="variable">.managedObjectContext</span> deleteObject:user];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断是否删除成功</span></span><br><span class="line">    <span class="built_in">BOOL</span> isDeleteSuccess = [myAppDelegate<span class="variable">.managedObjectContext</span> save:&amp;error];<span class="comment">//保存（容易忘）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!isDeleteSuccess) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error:%@"</span>,error);</span><br><span class="line">    </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"delete Successful!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/18/核心数据? 有什么用途/" data-id="ciiz8n9i20004cmq0qzuucbho" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/18/核心数据? 有什么用途/#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-XMPP即时通讯" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/15/XMPP即时通讯/">XMPP协议</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/15/XMPP即时通讯/">
      <time datetime="2015-12-14T16:00:00.000Z" itemprop="datePublished">2015-12-15</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h1 id="XMPP_u5373_u65F6_u901A_u8BAF"><a href="#XMPP_u5373_u65F6_u901A_u8BAF" class="headerlink" title="XMPP即时通讯"></a>XMPP即时通讯</h1><h3 id="1-__u4EC0_u4E48_u662FXMPP_2C__u5B9E_u73B0_u7684_u529F_u80FD_3F"><a href="#1-__u4EC0_u4E48_u662FXMPP_2C__u5B9E_u73B0_u7684_u529F_u80FD_3F" class="headerlink" title="1. 什么是XMPP, 实现的功能?"></a>1. 什么是XMPP, 实现的功能?</h3><p>全称:可扩展通讯和表示协议</p>
<p>简介:可扩展通讯和表示协议 (XMPP) 可用于服务类实时通讯、表示和需求响应服务中的XML数据元流式传输。XMPP以Jabber协议为基础，而Jabber是即时通讯中常用的开放式协议。XMPP is the IETF’s formalization of the base XML streaming protocols for instant messaging and presence developed within the Jabber open-source community in 1999</p>
<p>XMPP（可扩展消息处理现场协议）是基于可扩展标记语言（XML）的协议，它用于即时消息（IM）以及在线现场探测。它在促进服务器之间的准即时操作。这个协议可能最终允许因特网用户向因特网上的其他任何人发送即时消息，即使其操作系统和浏览器不同。</p>
<p>XMPP的前身是Jabber，一个开源形式组织产生的网络即时通信协议。XMPP目前被IETF国际标准组织完成了标准化工作。标准化的核心结果分为两部分；<br>核心的XML流传输协议<br>基于XMLFreeEIM流传输的即时通讯扩展应用</p>
<p>XMPP的核心XML流传输协议的定义使得XMPP能够在一个比以往网络通信协议更规范的平台上。借助于XML易于解析和阅读的特性，使得XMPP的协议能够非常漂亮。<br>XMPP的即时通讯扩展应用部分是根据IETF在这之前对即时通讯的一个抽象定义的，与其他业已得到广泛使用的即时通讯协议，诸如AIM，QQ等有功能完整，完善等先进性。</p>
<p>XMPP的扩展协议Jingle使得其支持语音和视频。</p>
<p>XMPP的官方文档是RFC 3920.</p>
<h3 id="2-_XMPP_u914D_u7F6E"><a href="#2-_XMPP_u914D_u7F6E" class="headerlink" title="2. XMPP配置"></a>2. XMPP配置</h3><h4 id="u5BFC_u5165_u5F00_u53D1_u5305"><a href="#u5BFC_u5165_u5F00_u53D1_u5305" class="headerlink" title="导入开发包"></a>导入开发包</h4><p>XMPPFramework</p>
<h4 id="u5BFC_u5165_u4F9D_u8D56_u5E93"><a href="#u5BFC_u5165_u4F9D_u8D56_u5E93" class="headerlink" title="导入依赖库"></a>导入依赖库</h4><p>需要添加的库</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">libXml2  需要设置$(SDKROOT)/usr/include/libxml2</span><br><span class="line">libresolv</span><br><span class="line">CFNetWork</span><br><span class="line">Security</span><br><span class="line">libidn.<span class="function"><span class="title">a</span><span class="params">(加入xmppFrameWork就有)</span></span></span><br><span class="line">在Xcode5.<span class="number">0</span>需要加入systemConfiguration库防止SCnetWork错误，<span class="number">5.1</span>版本则不需要</span><br></pre></td></tr></table></figure>
<h3 id="3-_XMPP_u5355_u4F8B_u7BA1_u7406_u7C7B"><a href="#3-_XMPP_u5355_u4F8B_u7BA1_u7406_u7C7B" class="headerlink" title="3. XMPP单例管理类"></a>3. XMPP单例管理类</h3><h4 id="u5305_u542B_u5934_u6587_u4EF6"><a href="#u5305_u542B_u5934_u6587_u4EF6" class="headerlink" title="包含头文件"></a>包含头文件</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">"XMPPFramework.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">"XMPPRoster.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"XMPPRosterMemoryStorage.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">"XMPPMessageArchiving.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"XMPPMessageArchivingCoreDataStorage.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义服务器</span></span><br><span class="line"><span class="preprocessor">#define kXMPP_HOST @<span class="title">"192.168.1.8"</span></span></span><br><span class="line"><span class="comment">//定义资源</span></span><br><span class="line"><span class="preprocessor">#define kXMPP_RESOURCE @<span class="title">"iPhone"</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#define kXMPP_ROSTER_CHANGE @<span class="title">"kXMPP_ROSTER_CHANGE"</span></span></span><br><span class="line"><span class="preprocessor">#define kXMPP_MESSAGE_CHANGE @<span class="title">"kXMPP_MESSAGE_CHANGE"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZJXMPPManager</span> : <span class="title">NSObject</span>&lt;<span class="title">XMPPStreamDelegate</span>,<span class="title">XMPPRosterDelegate</span>,<span class="title">XMPPRosterMemoryStorageDelegate</span>,<span class="title">XMPPMessageArchivingStorage</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//单例对象</span></span><br><span class="line">+(instancetype)manager;</span><br><span class="line"></span><br><span class="line"><span class="comment">//流对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>,<span class="keyword">nonatomic</span>) X<span class="built_in">MPPStream</span> *xmppStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">//好友模块</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) X<span class="built_in">MPPRoster</span> *xmppRoster;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) X<span class="built_in">MPPRosterMemoryStorage</span> *xmppRosterMemoryStorage;</span><br><span class="line"></span><br><span class="line"><span class="comment">//消息存储模块</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) X<span class="built_in">MPPMessageArchiving</span> *xmppMessageArchiving;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) X<span class="built_in">MPPMessageArchivingCoreDataStorage</span> *xmppMessageArchivingCoreDataStorage;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) X<span class="built_in">MPPPresence</span> *receivePresence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="u5355_u4F8B_u7C7B_u5B9E_u73B0"><a href="#u5355_u4F8B_u7C7B_u5B9E_u73B0" class="headerlink" title="单例类实现"></a>单例类实现</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">"ZJXMPPManager.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZJXMPPManager</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ZJXMPPManager</span></span></span><br><span class="line">+(instancetype)manager</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> ZJX<span class="built_in">MPPManager</span> *manager = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span>(manager == <span class="literal">nil</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        manager = [[ZJX<span class="built_in">MPPManager</span> alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> manager;</span><br><span class="line">&#125;</span><br><span class="line">-(instancetype)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span> = [<span class="keyword">super</span> init])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.xmppStream</span> == <span class="literal">nil</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//创建初始化</span></span><br><span class="line">            <span class="keyword">self</span><span class="variable">.xmppStream</span> = [[X<span class="built_in">MPPStream</span> alloc] init];</span><br><span class="line">            [<span class="keyword">self</span><span class="variable">.xmppStream</span> addDelegate:<span class="keyword">self</span> delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//激活好友模块</span></span><br><span class="line">            [<span class="keyword">self</span> loadRosterModule];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//激活消息归档模块</span></span><br><span class="line">            [<span class="keyword">self</span> loadMessageArchivingModule];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u6FC0_u6D3B_u6D88_u606F_u6A21_u5757"><a href="#u6FC0_u6D3B_u6D88_u606F_u6A21_u5757" class="headerlink" title="激活消息模块"></a>激活消息模块</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#pragma mark - 消息存储模块</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)loadMessageArchivingModule</span><br><span class="line">&#123;</span><br><span class="line">    _xmppMessageArchivingCoreDataStorage = [X<span class="built_in">MPPMessageArchivingCoreDataStorage</span> sharedInstance];</span><br><span class="line">    _xmppMessageArchiving = [[X<span class="built_in">MPPMessageArchiving</span> alloc] initWithMessageArchivingStorage:_xmppMessageArchivingCoreDataStorage dispatchQueue:dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, <span class="number">9</span>)];</span><br><span class="line">    [_xmppMessageArchiving activate:<span class="keyword">self</span><span class="variable">.xmppStream</span>];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.xmppMessageArchiving</span> addDelegate:<span class="keyword">self</span> delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)archiveMessage:(X<span class="built_in">MPPMessage</span> *)message outgoing:(<span class="built_in">BOOL</span>)isOutgoing xmppStream:(X<span class="built_in">MPPStream</span> *)stream</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"存储消息"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u6FC0_u6D3B_u597D_u53CB_u6A21_u5757"><a href="#u6FC0_u6D3B_u597D_u53CB_u6A21_u5757" class="headerlink" title="激活好友模块"></a>激活好友模块</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 好友模块</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)loadRosterModule</span><br><span class="line">&#123;</span><br><span class="line">    _xmppRosterMemoryStorage = [[X<span class="built_in">MPPRosterMemoryStorage</span> alloc] init];</span><br><span class="line">    _xmppRoster = [[X<span class="built_in">MPPRoster</span> alloc] initWithRosterStorage:_xmppRosterMemoryStorage];</span><br><span class="line">    [_xmppRoster activate:<span class="keyword">self</span><span class="variable">.xmppStream</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//同时给_xmppRosterMemoryStorage 和 _xmppRoster都添加了代理</span></span><br><span class="line">    [_xmppRoster addDelegate:<span class="keyword">self</span> delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">    <span class="comment">//设置好友同步策略,XMPP一旦连接成功，同步好友到本地</span></span><br><span class="line">    [_xmppRoster setAutoFetchRoster:<span class="literal">YES</span>]; <span class="comment">//自动同步，从服务器取出好友</span></span><br><span class="line">    <span class="comment">//关掉自动接收好友请求，默认开启自动同意</span></span><br><span class="line">    [_xmppRoster setAutoAcceptKnownPresenceSubscriptionRequests:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//接收到好友请求</span></span><br><span class="line">-(<span class="keyword">void</span>)xmppRoster:(X<span class="built_in">MPPRoster</span> *)sender didReceivePresenceSubscriptionRequest:(X<span class="built_in">MPPPresence</span> *)presence</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//添加好友一定会订阅对方，但是接受订阅不一定要添加对方为好友</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.receivePresence</span> = presence;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    NSString *message = [NSString stringWithFormat:@"【%@】想加你为好友",presence.from.bare];</span><br><span class="line">    UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:nil message:message delegate:self cancelButtonTitle:@"拒绝" otherButtonTitles:@"同意", nil];</span><br><span class="line">    [alertView show];</span><br><span class="line">     */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//收到每个好友</span></span><br><span class="line">-(<span class="keyword">void</span>)xmppRoster:(X<span class="built_in">MPPRoster</span> *)sender didReceiveRosterItem:(DDXMLElement *)item</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)xmppRosterDidBeginPopulating:(X<span class="built_in">MPPRoster</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"开始同步好友列表"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)xmppRosterDidEndPopulating:(X<span class="built_in">MPPRoster</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"结束同步好友列表"</span>);</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kX<span class="built_in">MPP_ROSTER_CHANGE</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//XMPPRosterMemoryStorage delegate</span></span><br><span class="line"><span class="comment">//  如果不是初始化好友变了, 自动同步</span></span><br><span class="line">-(<span class="keyword">void</span>)xmppRosterDidChange:(X<span class="built_in">MPPRosterMemoryStorage</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kX<span class="built_in">MPP_ROSTER_CHANGE</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-__u8FDE_u63A5_u670D_u52A1_u5668"><a href="#4-__u8FDE_u63A5_u670D_u52A1_u5668" class="headerlink" title="4. 连接服务器"></a>4. 连接服务器</h3><h4 id="u8FDE_u63A5_u64CD_u4F5C"><a href="#u8FDE_u63A5_u64CD_u4F5C" class="headerlink" title="连接操作"></a>连接操作</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 连接服务器</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)connect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *username = <span class="string">@"temp"</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *host = kX<span class="built_in">MPP_HOST</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *resource = kX<span class="built_in">MPP_RESOURCE</span>;</span><br><span class="line">    </span><br><span class="line">    X<span class="built_in">MPPJID</span> *jid = [X<span class="built_in">MPPJID</span> jidWithUser:username domain:host resource:resource];</span><br><span class="line">    [_xmppStream setMyJID:jid];</span><br><span class="line">    [_xmppStream setHostName:host];</span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (![_xmppStream connectWithTimeout:<span class="number">10</span> error:&amp;error]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Connect Error: %@"</span>, [[error userInfo] description]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)xmppStreamDidConnect:(X<span class="built_in">MPPStream</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"连接成功"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)xmppStreamDidDisconnect:(X<span class="built_in">MPPStream</span> *)sender withError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"连接失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-__u767B_u9646_u64CD_u4F5C"><a href="#5-__u767B_u9646_u64CD_u4F5C" class="headerlink" title="5. 登陆操作"></a>5. 登陆操作</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 登陆</span></span><br><span class="line">-(<span class="keyword">void</span>)login</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *username = _username<span class="variable">.text</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *password = _password<span class="variable">.text</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取用户名, 设置新的jid</span></span><br><span class="line">    X<span class="built_in">MPPJID</span> *jid = [X<span class="built_in">MPPJID</span> jidWithUser:username domain:kX<span class="built_in">MPP_HOST</span> resource:kX<span class="built_in">MPP_RESOURCE</span>];</span><br><span class="line">    _xmppStream<span class="variable">.myJID</span> = jid;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//连接成功后认证用户名和密码</span></span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    [_xmppStream authenticateWithPassword:password error:&amp;error];</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"认证错误：%@"</span>,[error localizedDescription]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)xmppStreamDidAuthenticate:(X<span class="built_in">MPPStream</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"认证成功"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//发送上线通知</span></span><br><span class="line">    X<span class="built_in">MPPPresence</span> *presence = [X<span class="built_in">MPPPresence</span> presence];</span><br><span class="line">    [_xmppStream sendElement:presence];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> showList];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)xmppStream:(X<span class="built_in">MPPStream</span> *)sender didNotAuthenticate:(DDXMLElement *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"认证失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-__u6CE8_u518C_u64CD_u4F5C"><a href="#6-__u6CE8_u518C_u64CD_u4F5C" class="headerlink" title="6. 注册操作"></a>6. 注册操作</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 注册用户</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)reg</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"开始注册"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *username = _usernameTextField<span class="variable">.text</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *password = _passwordTextField<span class="variable">.text</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *host = <span class="string">@"1000phone.net"</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *resource = <span class="string">@"iPhone"</span>;</span><br><span class="line">    </span><br><span class="line">    X<span class="built_in">MPPJID</span> *jid = [X<span class="built_in">MPPJID</span> jidWithUser:username domain:host resource:resource];</span><br><span class="line">    [_xmppStream setMyJID:jid];</span><br><span class="line">    <span class="built_in">NSError</span> *error=<span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (![_xmppStream registerWithPassword:password error:&amp;error])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"创建错误 error=%@"</span>,error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)xmppStreamDidRegister:(X<span class="built_in">MPPStream</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"注册成功"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)xmppStream:(X<span class="built_in">MPPStream</span> *)sender didNotRegister:(DDXMLElement *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"注册失败, error = %@"</span>,error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-__u83B7_u53D6_u597D_u53CB_u5217_u8868"><a href="#7-__u83B7_u53D6_u597D_u53CB_u5217_u8868" class="headerlink" title="7. 获取好友列表"></a>7. 获取好友列表</h4><p>首先执行获取方法</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> rosterChange];</span><br><span class="line"></span><br><span class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(rosterChange) name:kX<span class="built_in">MPP_ROSTER_CHANGE</span> object:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>获取数据</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)rosterChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//从存储器中取出我得好友数组，更新数据源</span></span><br><span class="line">    X<span class="built_in">MPPRosterMemoryStorage</span> *storage = [ZJX<span class="built_in">MPPManager</span> manager]<span class="variable">.xmppRosterMemoryStorage</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//对象类型 XMPPUserMemoryStorageObject *user</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.contacts</span> = [<span class="built_in">NSMutableArray</span> arrayWithArray:storage<span class="variable">.unsortedUsers</span>];</span><br><span class="line">    </span><br><span class="line">    [_tableView reloadData];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-__u53D1_u9001_u6D88_u606F"><a href="#8-__u53D1_u9001_u6D88_u606F" class="headerlink" title="8. 发送消息"></a>8. 发送消息</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">X<span class="built_in">MPPMessage</span> *message = [X<span class="built_in">MPPMessage</span> messageWithType:<span class="string">@"chat"</span> to:<span class="keyword">self</span><span class="variable">.chatJID</span>];</span><br><span class="line">[message addBody:_messageTextField<span class="variable">.text</span>];</span><br><span class="line">[_xmppStream sendElement:message];</span><br></pre></td></tr></table></figure>
<h4 id="9-__u63A5_u53D7_u6D88_u606F"><a href="#9-__u63A5_u53D7_u6D88_u606F" class="headerlink" title="9. 接受消息"></a>9. 接受消息</h4><p>首先添加代理</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_xmppStream = [ZJX<span class="built_in">MPPManager</span> manager]<span class="variable">.xmppStream</span>;</span><br><span class="line">[_xmppStream addDelegate:<span class="keyword">self</span> delegateQueue:dispatch_get_main_queue()];</span><br></pre></td></tr></table></figure>
<p>实现收到消息的代理方法</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)xmppStream:(X<span class="built_in">MPPStream</span> *)sender didReceiveMessage:(X<span class="built_in">MPPMessage</span> *)message</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"message get"</span>);</span><br><span class="line">    </span><br><span class="line">    [_dataArray addObject:message];</span><br><span class="line">    </span><br><span class="line">    [_tableView reloadData];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/15/XMPP即时通讯/" data-id="ciiz8n9ie000ecmq0xxp361m2" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/15/XMPP即时通讯/#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-hexo写博客" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/10/hexo写博客/">hexo写博客</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/10/hexo写博客/">
      <time datetime="2015-12-10T14:57:04.000Z" itemprop="datePublished">2015-12-10</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h3 id="u5199_u65B0_u7684_u6587_u7AE0"><a href="#u5199_u65B0_u7684_u6587_u7AE0" class="headerlink" title="写新的文章"></a>写新的文章</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new 文章名字</span><br></pre></td></tr></table></figure>
<p>更多信息: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="u672C_u5730_u9884_u89C8"><a href="#u672C_u5730_u9884_u89C8" class="headerlink" title="本地预览"></a>本地预览</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>更多信息: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="u751F_u6210_u9759_u6001_u6587_u4EF6"><a href="#u751F_u6210_u9759_u6001_u6587_u4EF6" class="headerlink" title="生成静态文件"></a>生成静态文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="u53D1_u5E03"><a href="#u53D1_u5E03" class="headerlink" title="发布"></a>发布</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>更多信息: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/10/hexo写博客/" data-id="ciiz8n9ia0008cmq0ac0xnhk0" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/10/hexo写博客/#disqus_thread" class="article-comment-link">评论</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo-github/">hexo github</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-cocoapods使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/10/cocoapods使用/">cocoapods使用</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/10/cocoapods使用/">
      <time datetime="2015-12-10T10:06:54.000Z" itemprop="datePublished">2015-12-10</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h2 id="CocoaPods"><a href="#CocoaPods" class="headerlink" title="CocoaPods"></a>CocoaPods</h2><blockquote>
<p>写在前面，我的环境是OS X 10.11.1  Xcode 7.1 </p>
</blockquote>
<p> CocoaPods是第三方依赖库管理工具,    在iOS开发中非常流行，基本是成为第三方依赖库管理的事实标准。</p>
<blockquote>
<p><a href="https://cocoapods.org/" target="_blank" rel="external">官网</a></p>
<p><a href="https://github.com/CocoaPods/CocoaPods" target="_blank" rel="external">github地址</a></p>
</blockquote>
<h2 id="u5982_u4F55_u4F7F_u7528"><a href="#u5982_u4F55_u4F7F_u7528" class="headerlink" title="如何使用"></a>如何使用</h2><p>1.修改ruby源,官方是国外的源，由于某种神奇的东西，速度奇慢，还经常上不了，改为国内的淘宝源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem sources --add https://ruby.taobao.org/ --remove https://rubygems.org/</span><br><span class="line">gem sources <span class="operator">-l</span></span><br></pre></td></tr></table></figure>
<p>2.安装cocoapods</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods (sudo npm install cocoapods)</span><br></pre></td></tr></table></figure>
<p>3.cd 工程的根目录</p>
<blockquote>
<p>切换到工程根目录</p>
</blockquote>
<p>4.touch Podfile</p>
<blockquote>
<p>创建Podfile文件</p>
</blockquote>
<p>5.vim Podfile(写入内容)</p>
<blockquote>
<p>pod ‘xxx’,’~&gt; y’<br>xxx表示第三方库名称，y表示第三方库的版本号</p>
</blockquote>
<p>6.pod search XX</p>
<blockquote>
<p>搜索名字XX的库，搜索结果会显示如何添加到Podfile中<br>7.pod install</p>
</blockquote>
<p>8.工程名字.xcworkspace</p>
<blockquote>
<p>install 结束后，根目录下会多出个工程名字.xcworkspace的文件，双击打开工程就行了</p>
</blockquote>
<p>9.在build setting 添加searchpath（$SRCROOT）</p>
<blockquote>
<p>会在#import时提醒</p>
</blockquote>
<p>10.不升级CocoaPods的spec仓库</p>
<blockquote>
<p>   pod install –verbose –no-repo-update</p>
<p>   pod update –verbose –no-repo-update</p>
</blockquote>
<h3 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a href="http://blog.devtang.com/blog/2014/05/25/use-cocoapod-to-manage-ios-lib-dependency/" target="_blank" rel="external">参考1</a></p>
<p><a href="https://github.com/ChenYilong/CYLTabBarController" target="_blank" rel="external">参考2</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/10/cocoapods使用/" data-id="ciiz8n9ic000bcmq0nvhyhk2s" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/10/cocoapods使用/#disqus_thread" class="article-comment-link">评论</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-CocoaPods/">iOS CocoaPods</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-NSAttributedString属性字符串" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/10/NSAttributedString属性字符串/">NSAttributedString属性字符串</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/10/NSAttributedString属性字符串/">
      <time datetime="2015-12-09T16:00:00.000Z" itemprop="datePublished">2015-12-10</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h2 id="NSAttributedString_u5C5E_u6027_u5B57_u7B26_u4E32"><a href="#NSAttributedString_u5C5E_u6027_u5B57_u7B26_u4E32" class="headerlink" title="NSAttributedString属性字符串"></a>NSAttributedString属性字符串</h2><p>###1. 什么是NSAttributedString?</p>
<p>属性字符串, 可以设置一个字符串显示的时候不同的区域显示不同的颜色, 不同的字体…..</p>
<p>###2. 基本使用</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建label</span></span><br><span class="line"><span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>)];</span><br><span class="line">label<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">label<span class="variable">.numberOfLines</span> = <span class="number">0</span>;</span><br><span class="line">[<span class="keyword">self</span><span class="variable">.view</span> addSubview:label];</span><br><span class="line"></span><br><span class="line"><span class="comment">//属性字符串</span></span><br><span class="line"><span class="built_in">NSString</span> *string = <span class="string">@"Label Text Content, This is a text label things attribute"</span>;</span><br><span class="line"><span class="built_in">NSMutableAttributedString</span> *attrString = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:string];</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置属性字符串</span></span><br><span class="line"><span class="comment">//设置字体</span></span><br><span class="line"><span class="built_in">UIFont</span> *baseFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">36</span>];</span><br><span class="line">[attrString addAttribute:<span class="built_in">NSFontAttributeName</span> value:baseFont range:[string rangeOfString:<span class="string">@"Label"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置显示</span></span><br><span class="line">label<span class="variable">.attributedText</span> = attrString;</span><br></pre></td></tr></table></figure>
<p>###3. 设置</p>
<h4 id="u8BBE_u7F6E_u7C97_u4F53"><a href="#u8BBE_u7F6E_u7C97_u4F53" class="headerlink" title="设置粗体"></a>设置粗体</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置粗体</span></span><br><span class="line">    <span class="built_in">UIFont</span> *boldFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">36</span>];</span><br><span class="line">    [attrString addAttribute:<span class="built_in">NSFontAttributeName</span> value:boldFont range:[string rangeOfString:<span class="string">@"Label"</span>]];</span><br></pre></td></tr></table></figure>
<h4 id="u8BBE_u7F6E_u989C_u8272"><a href="#u8BBE_u7F6E_u989C_u8272" class="headerlink" title="设置颜色"></a>设置颜色</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIColor</span> *color = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">[attrString addAttribute:<span class="built_in">NSForegroundColorAttributeName</span></span><br><span class="line"> value:color</span><br><span class="line">range:[string rangeOfString:<span class="string">@"Label"</span>]];</span><br></pre></td></tr></table></figure>
<h4 id="u6DFB_u52A0_u80CC_u666F_u8272"><a href="#u6DFB_u52A0_u80CC_u666F_u8272" class="headerlink" title="添加背景色"></a>添加背景色</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    [attrString addAttribute:<span class="built_in">NSBackgroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:[string rangeOfString:<span class="string">@"Label"</span>]];</span><br><span class="line">```    </span><br><span class="line">    </span><br><span class="line"><span class="preprocessor">#### 设置字符间距</span></span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line">     [attrString addAttribute:<span class="built_in">NSKernAttributeName</span> value:@<span class="number">2</span> range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, length)];<span class="comment">//字符间距 2pt</span></span><br><span class="line">```    </span><br><span class="line"><span class="preprocessor">#### 设置空心文字</span></span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line">    [attrString addAttribute:<span class="built_in">NSStrokeWidthAttributeName</span> value:@<span class="number">2</span> range:[string rangeOfString:<span class="string">@"Text"</span>]];<span class="comment">//空心字，文字边框描述</span></span><br><span class="line">```    </span><br><span class="line"><span class="preprocessor">#### 设置文字描边颜色</span></span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line">    [attrString addAttribute:<span class="built_in">NSStrokeColorAttributeName</span> value:[<span class="built_in">UIColor</span> greenColor] range:[string rangeOfString:<span class="string">@"Text"</span>]];<span class="comment">//设置文字描边颜色，需要和NSStrokeWidthAttributeName设置描边宽度，这样就能使文字空心</span></span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="preprocessor">#### 设置下划线</span></span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line">    [attrString addAttribute:<span class="built_in">NSUnderlineStyleAttributeName</span> value:@(<span class="built_in">NSUnderlineStyleSingle</span>) range:[string rangeOfString:<span class="string">@"Label"</span>]];<span class="comment">//下划线</span></span><br></pre></td></tr></table></figure>
<h4 id="u4E0B_u5212_u7EBF_u989C_u8272"><a href="#u4E0B_u5212_u7EBF_u989C_u8272" class="headerlink" title="下划线颜色"></a>下划线颜色</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    [attrString addAttribute:<span class="built_in">NSUnderlineColorAttributeName</span> value:[<span class="built_in">UIColor</span> greenColor] range:[string rangeOfString:<span class="string">@"Label"</span>]];</span><br><span class="line">```    </span><br><span class="line">    </span><br><span class="line"><span class="preprocessor">#### 删除线</span></span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line">    [attrString addAttribute:<span class="built_in">NSStrikethroughStyleAttributeName</span> value:@(<span class="built_in">NSUnderlinePatternSolid</span> | <span class="built_in">NSUnderlineStyleThick</span>) range:[string rangeOfString:<span class="string">@"Content"</span>]];<span class="comment">//删除线</span></span><br></pre></td></tr></table></figure>
<h4 id="u5220_u9664_u7EBF_u989C_u8272"><a href="#u5220_u9664_u7EBF_u989C_u8272" class="headerlink" title="删除线颜色"></a>删除线颜色</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[attrString addAttribute:<span class="built_in">NSStrikethroughColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:[string rangeOfString:<span class="string">@"Content"</span>]];<span class="comment">//删除线蓝色</span></span><br></pre></td></tr></table></figure>
<h4 id="u8BBE_u7F6E_u6BB5_u843D"><a href="#u8BBE_u7F6E_u6BB5_u843D" class="headerlink" title="设置段落"></a>设置段落</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以对这些属性设置值</span></span><br><span class="line"><span class="built_in">NSMutableParagraphStyle</span> *</span><br><span class="line">style = [[<span class="built_in">NSParagraphStyle</span> defaultParagraphStyle] mutableCopy];</span><br><span class="line">style<span class="variable">.lineSpacing</span> = <span class="number">10</span>;<span class="comment">//增加行高</span></span><br><span class="line">style<span class="variable">.firstLineHeadIndent</span> = <span class="number">30</span>;<span class="comment">//首行头缩进</span></span><br><span class="line">style<span class="variable">.headIndent</span> = <span class="number">20</span>;<span class="comment">//头部缩进，相当于左padding</span></span><br><span class="line">style<span class="variable">.tailIndent</span> = -<span class="number">20</span>;<span class="comment">//相当于右padding</span></span><br><span class="line">style<span class="variable">.lineHeightMultiple</span> = <span class="number">1.5</span>;<span class="comment">//行间距是多少倍</span></span><br><span class="line">style<span class="variable">.alignment</span> = <span class="built_in">NSTextAlignmentLeft</span>;<span class="comment">//对齐方式</span></span><br><span class="line"></span><br><span class="line">style<span class="variable">.paragraphSpacing</span> = <span class="number">10</span>;<span class="comment">//段落后面的间距</span></span><br><span class="line">style<span class="variable">.paragraphSpacingBefore</span> = <span class="number">20</span>;<span class="comment">//段落之前的间距</span></span><br><span class="line">[attrString addAttribute:<span class="built_in">NSParagraphStyleAttributeName</span> value:style range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, length)];</span><br><span class="line"><span class="comment">//段落样式</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> lineSpacing;                         来增加行距</span><br><span class="line"> paragraphSpacing;</span><br><span class="line"> alignment;                           对齐</span><br><span class="line"> firstLineHeadIndent;                 段落开始的缩排像素</span><br><span class="line"> headIndent;                          可调整全部文字的缩排距离，可当作左边 padding 使用</span><br><span class="line"> tailIndent;                          可调整文字尾端的缩排距离。需要注意的是，这里指定的值可以当作文字显示的宽、而也可当作右边 padding 使用，依据输入的正负值而定：</span><br><span class="line"> lineBreakMode;</span><br><span class="line"> minimumLineHeight;</span><br><span class="line"> maximumLineHeight;        而针对不同的字型与字号，我们可以透过指定最大与最小行距（maximumLineHeight 与 minimumLineHeight）来避免过高或过窄的状况发生。</span><br><span class="line"> baseWritingDirection;</span><br><span class="line"> lineHeightMultiple;                  想要调整行距，可以透过搭配使用 lineHeightMultiple 更改行距倍数</span><br><span class="line"> paragraphSpacingBefore; 而若是文章内容有分段落的话，也可以透过指定段落结尾距离（paragraphSpacing）以及段落开头距离（paragraphSpacingBefore）:</span><br><span class="line"> hyphenationFactor;</span><br><span class="line"> @property(readwrite,copy,NS_NONATOMIC_IOSONLY) NSArray *tabStops NS_AVAILABLE_IOS(7_0);</span><br><span class="line"> @property(readwrite,NS_NONATOMIC_IOSONLY) CGFloat defaultTabInterval NS_AVAILABLE_IOS(7_0);</span><br><span class="line"> */</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/10/NSAttributedString属性字符串/" data-id="ciiz8n9ih000fcmq0mvjlz49p" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/10/NSAttributedString属性字符串/#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-CoreGraphics核心绘图 " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/05/CoreGraphics核心绘图 /">CoreGraphics核心绘图</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/12/05/CoreGraphics核心绘图 /">
      <time datetime="2015-12-04T16:00:00.000Z" itemprop="datePublished">2015-12-05</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h2 id="CoreGraphics_u6838_u5FC3_u7ED8_u56FE"><a href="#CoreGraphics_u6838_u5FC3_u7ED8_u56FE" class="headerlink" title="CoreGraphics核心绘图"></a>CoreGraphics核心绘图</h2><h3 id="1-__u4EC0_u4E48_u662F_u6838_u5FC3_u7ED8_u56FE"><a href="#1-__u4EC0_u4E48_u662F_u6838_u5FC3_u7ED8_u56FE" class="headerlink" title="1. 什么是核心绘图"></a>1. 什么是核心绘图</h3><p>CoreGraphics.framework 是iOS 内置的用于画图的框架，可以画自定义的几何图形，它支持图形上下文、加载图像、绘制图像，等等。</p>
<h3 id="2-__u6838_u5FC3_u7ED8_u56FE_u7684_u57FA_u672C_u4F7F_u7528"><a href="#2-__u6838_u5FC3_u7ED8_u56FE_u7684_u57FA_u672C_u4F7F_u7528" class="headerlink" title="2. 核心绘图的基本使用"></a>2. 核心绘图的基本使用</h3><p>图形上下文类似画家的画布，承载绘图动作。绘图动作顺序执行，新动作在前一个动作的基础上完成。<br>最常见的用法是继承一个UIView的子类，重载其drawRect。视图刷新或者重绘drawRect都会被调用。调用频率很高，所以应该极为轻量级。<br>从不直接调用drawRect，需要重绘使用setNeedDisplay（作用是让iOS根据它的安排调用drawRect）。<br>图形上下文的属性是状态相关的，改变属性会影响所有后续操作。</p>
<h4 id="281_29_u9996_u5148_u521B_u5EFA_u4E00_u4E2A_u7C7B"><a href="#281_29_u9996_u5148_u521B_u5EFA_u4E00_u4E2A_u7C7B" class="headerlink" title="(1)首先创建一个类"></a>(1)首先创建一个类</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Canvas</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==实现==</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Canvas.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Canvas</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">// Only override drawRect: if you perform custom drawing.</span><br><span class="line">// An empty implementation adversely affects performance during animation.</span><br><span class="line">- (void)drawRect:(CGRect)rect &#123;</span><br><span class="line">    // Drawing code</span><br><span class="line">&#125;</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="282_29_u753B_u4E00_u6761_u7EBF"><a href="#282_29_u753B_u4E00_u6761_u7EBF" class="headerlink" title="(2)画一条线"></a>(2)画一条线</h4><p>Canvas.m中添加方法</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawLine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> startPoint = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">CGPoint</span> endPoint = <span class="built_in">CGPointMake</span>(<span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//画直线</span></span><br><span class="line">    <span class="comment">// 可以获得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//设置起点和终点</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startPoint<span class="variable">.x</span>, startPoint<span class="variable">.y</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, endPoint<span class="variable">.x</span>,endPoint<span class="variable">.y</span>);</span><br><span class="line">    <span class="comment">//设置线宽</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] setStroke];</span><br><span class="line">    <span class="comment">// 闭合路径描边</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="283_29__u53BB_u6389_drawInRect_u7684_u6CE8_u91CA_2C__u6267_u884C_u65B9_u6CD5"><a href="#283_29__u53BB_u6389_drawInRect_u7684_u6CE8_u91CA_2C__u6267_u884C_u65B9_u6CD5" class="headerlink" title="(3) 去掉 drawInRect的注释, 执行方法"></a>(3) 去掉 drawInRect的注释, 执行方法</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">-</span> (void)<span class="tag">drawRect</span>:(CGRect)<span class="tag">rect</span> &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr_selector">[self drawLine]</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-__u6838_u5FC3_u7ED8_u56FE_u5E38_u7528_u5B9E_u73B0"><a href="#3-__u6838_u5FC3_u7ED8_u56FE_u5E38_u7528_u5B9E_u73B0" class="headerlink" title="3. 核心绘图常用实现"></a>3. 核心绘图常用实现</h3><h4 id="u7ED8_u5236_u6587_u672C"><a href="#u7ED8_u5236_u6587_u672C" class="headerlink" title="绘制文本"></a>绘制文本</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawText</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *s = <span class="string">@"我的小狗"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//[s drawAtPoint:CGPointMake(100, 0) withFont:[UIFont systemFontOfSize:34.0]];</span></span><br><span class="line">    [s drawAtPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">40</span>) withAttributes:@&#123;<span class="built_in">NSFontAttributeName</span>:[<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">24</span>],<span class="built_in">NSForegroundColorAttributeName</span>:[<span class="built_in">UIColor</span> blueColor]&#125;];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//    NSString *NSFontAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSParagraphStyleAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSForegroundColorAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSUnderlineStyleAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSSuperscriptAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSBackgroundColorAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSAttachmentAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSLigatureAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSBaselineOffsetAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSKernAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSLinkAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSStrokeWidthAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSStrokeColorAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSUnderlineColorAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSStrikethroughStyleAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSStrikethroughColorAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSShadowAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSObliquenessAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSExpansionAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSCursorAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSToolTipAttributeName;</span></span><br><span class="line"><span class="comment">//    NSString *NSMarkedClauseSegmentAttributeName;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236_u56FE_u7247"><a href="#u7ED8_u5236_u56FE_u7247" class="headerlink" title="绘制图片"></a>绘制图片</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span>* myImageObj = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"2_14.jpg"</span>];</span><br><span class="line">    <span class="comment">//[myImageObj drawAtPoint:CGPointMake(0, 0)];</span></span><br><span class="line">    [myImageObj drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">120</span>, <span class="number">300</span>, <span class="number">128</span>, <span class="number">192</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//UIImages的-drawRect:方法绘制图像:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//- [UIImage drawAtPoint:(CGPoint)point]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//- [UIImage drawInRect:(CGRect)rect]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//- [UIImage drawAsPatternInRect:(CGRect)rect]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236Bezier_u8D1D_u585E_u5C14_u66F2_u7EBF"><a href="#u7ED8_u5236Bezier_u8D1D_u585E_u5C14_u66F2_u7EBF" class="headerlink" title="绘制Bezier贝塞尔曲线"></a>绘制Bezier贝塞尔曲线</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawBezier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextRef</span> cgContext = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextBeginPath(cgContext);</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(cgContext, <span class="number">333</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">333</span>, <span class="number">0</span>, <span class="number">332</span>, <span class="number">26</span>, <span class="number">330</span>, <span class="number">26</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">330</span>, <span class="number">26</span>, <span class="number">299</span>, <span class="number">20</span>, <span class="number">299</span>, <span class="number">17</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(cgContext, <span class="number">296</span>, <span class="number">17</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">296</span>, <span class="number">17</span>, <span class="number">296</span>, <span class="number">19</span>, <span class="number">291</span>, <span class="number">19</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(cgContext, <span class="number">250</span>, <span class="number">19</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">250</span>, <span class="number">19</span>, <span class="number">241</span>, <span class="number">24</span>, <span class="number">238</span>, <span class="number">19</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">236</span>, <span class="number">20</span>, <span class="number">234</span>, <span class="number">24</span>, <span class="number">227</span>, <span class="number">24</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">220</span>, <span class="number">24</span>, <span class="number">217</span>, <span class="number">19</span>, <span class="number">216</span>, <span class="number">19</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">214</span>, <span class="number">20</span>, <span class="number">211</span>, <span class="number">22</span>, <span class="number">207</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">207</span>, <span class="number">20</span>, <span class="number">187</span>, <span class="number">20</span>, <span class="number">182</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(cgContext, <span class="number">100</span>, <span class="number">45</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(cgContext, <span class="number">97</span>, <span class="number">46</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">97</span>, <span class="number">46</span>, <span class="number">86</span>, <span class="number">71</span>, <span class="number">64</span>, <span class="number">72</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">42</span>, <span class="number">74</span>, <span class="number">26</span>, <span class="number">56</span>, <span class="number">23</span>, <span class="number">48</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(cgContext, <span class="number">9</span>, <span class="number">47</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(cgContext, <span class="number">9</span>, <span class="number">47</span>, <span class="number">0</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(cgContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236_u5F27_u7EBF"><a href="#u7ED8_u5236_u5F27_u7EBF" class="headerlink" title="绘制弧线"></a>绘制弧线</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawCurve</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> startPoint = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">CGPoint</span> controlPoint1 = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="built_in">CGPoint</span> controlPoint2 = <span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="built_in">CGPoint</span> endPoint = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">250</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextRef</span>     context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startPoint<span class="variable">.x</span>, startPoint<span class="variable">.y</span>);</span><br><span class="line">    <span class="built_in">CGContextAddCurveToPoint</span>(context,</span><br><span class="line">                             controlPoint1<span class="variable">.x</span>,</span><br><span class="line">                             controlPoint1<span class="variable">.y</span>,</span><br><span class="line">                             controlPoint2<span class="variable">.x</span>,</span><br><span class="line">                             controlPoint2<span class="variable">.y</span>,</span><br><span class="line">                             endPoint<span class="variable">.x</span>,</span><br><span class="line">                             endPoint<span class="variable">.y</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextDrawPath</span>(context,k<span class="built_in">CGPathStroke</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236_u4E09_u89D2_u5F62"><a href="#u7ED8_u5236_u4E09_u89D2_u5F62" class="headerlink" title="绘制三角形"></a>绘制三角形</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawTriangle</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span> (context, <span class="number">75</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span> (context, <span class="number">10</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span> (context, <span class="number">160</span>, <span class="number">150</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Closing the path connects the current point to the start of the current path.</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);</span><br><span class="line">    <span class="comment">// And stroke the path</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] setStroke];</span><br><span class="line">    <span class="comment">//CGContextStrokePath(context);</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] setFill];</span><br><span class="line">    <span class="built_in">CGContextDrawPath</span>(context, k<span class="built_in">CGPathFillStroke</span>);</span><br><span class="line">    <span class="comment">//kCGPathFillStroke,kCGPathFill,kCGPathStroke</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236_u5706"><a href="#u7ED8_u5236_u5706" class="headerlink" title="绘制圆"></a>绘制圆</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawCircle</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextRef不解释了，x,y为圆点坐标，startAngle为开始的弧度，endAngle为 结束的弧度，clockwise 0为顺时针，1为逆时针。</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, <span class="number">100</span>, <span class="number">250</span>, <span class="number">50</span>, <span class="number">0</span>, M_PI*<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextDrawPath</span>(context, k<span class="built_in">CGPathStroke</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236_u77E9_u5F62"><a href="#u7ED8_u5236_u77E9_u5F62" class="headerlink" title="绘制矩形"></a>绘制矩形</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawRect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] setStroke];</span><br><span class="line">    [[<span class="built_in">UIColor</span> blueColor] setFill];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextStrokePath(context);                 //空心</span></span><br><span class="line">    <span class="comment">//CGContextDrawPath(context, kCGPathStroke);    //空心</span></span><br><span class="line">    <span class="built_in">CGContextDrawPath</span>(context, k<span class="built_in">CGPathFillStroke</span>);  <span class="comment">//实心</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7ED8_u5236_u7EBF"><a href="#u7ED8_u5236_u7EBF" class="headerlink" title="绘制线"></a>绘制线</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawLine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> startPoint = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">CGPoint</span> endPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//画直线</span></span><br><span class="line">    <span class="comment">// 可以获得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//设置起点和终点</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startPoint<span class="variable">.x</span>, startPoint<span class="variable">.y</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, endPoint<span class="variable">.x</span>,endPoint<span class="variable">.y</span>);</span><br><span class="line">    <span class="comment">//设置线宽</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] setStroke];</span><br><span class="line">    <span class="comment">// 闭合路径描边</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://ikapop.com/2015/12/05/CoreGraphics核心绘图 /" data-id="ciiz8n9ik000gcmq0m3buvrhz" class="article-share-link">分享到</a>
      
        <a href="http://ikapop.com/2015/12/05/CoreGraphics核心绘图 /#disqus_thread" class="article-comment-link">评论</a>
      
      
    </footer>
  </div>
  
</article>



    </section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/01/07/JSON转Model方法/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2016/01/07/JSON转Model方法/" class="title">Json转换Model方法</a></p>
              <p class="item-date"><time datetime="2016-01-06T16:00:00.000Z" itemprop="datePublished">2016-01-07</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/01/01/我的2015/" class="thumbnail">
  
    <span style="background-image:url(http://7xp2md.com1.z0.glb.clouddn.com/2015.jpeg)" alt="我的2015" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2016/01/01/我的2015/" class="title">我的2015</a></p>
              <p class="item-date"><time datetime="2015-12-31T16:00:00.000Z" itemprop="datePublished">2016-01-01</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/12/26/Core Animation 核心动画/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2015/12/26/Core Animation 核心动画/" class="title">Core Animation 核心动画</a></p>
              <p class="item-date"><time datetime="2015-12-25T16:00:00.000Z" itemprop="datePublished">2015-12-26</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/12/20/通讯录使用/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2015/12/20/通讯录使用/" class="title">通讯录</a></p>
              <p class="item-date"><time datetime="2015-12-19T16:00:00.000Z" itemprop="datePublished">2015-12-20</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/12/18/核心数据? 有什么用途/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2015/12/18/核心数据? 有什么用途/" class="title">CoreData</a></p>
              <p class="item-date"><time datetime="2015-12-17T16:00:00.000Z" itemprop="datePublished">2015-12-18</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo-github/">hexo github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS-CocoaPods/">iOS CocoaPods</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/总结/">总结</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/hexo-github/" style="font-size: 10px;">hexo github</a> <a href="/tags/iOS-CocoaPods/" style="font-size: 10px;">iOS CocoaPods</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">8</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 ikapop<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>. 

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1256948974'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1256948974%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>

 
    </div>
  </div>
</footer>

    

<script>
  var disqus_shortname = 'ikapop';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>





 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?6a09f163754848b201d123ce1ca9f09f";
	  var s = document.getElementsByTagName("script")[0]; 
	    s.parentNode.insertBefore(hm, s);
		})();
		</script>


  </div>
</body>
</html>